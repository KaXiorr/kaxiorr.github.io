<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Gra GitHub - Test</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        #status { font-weight: bold; color: #007bff; }
        .box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: inline-block; margin-top: 20px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 15px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>

    <h1>Test Połączenia P2P</h1>
    <p>Status: <span id="status">Inicjalizacja...</span></p>

    <div class="box">
        <h3>Twój Identyfikator (ID):</h3>
        <p id="my-id" style="font-size: 1.2em; color: #d63384;">Czekam na ID...</p>
        <hr>
        <h3>Połącz się z kimś:</h3>
        <input type="text" id="peer-id-input" placeholder="Wpisz ID kolegi">
        <button onclick="connectToPeer()">Połącz</button>
    </div>

    <div id="game-area" style="margin-top: 20px; display: none;">
        <h3>Czat / Dane gry:</h3>
        <input type="text" id="msg-input" placeholder="Wiadomość...">
        <button onclick="sendData()">Wyślij dane</button>
        <div id="messages" style="margin-top: 10px; color: #555;"></div>
    </div>

    <script>
        const peer = new Peer(); // Tworzy nowe połączenie z darmowym serwerem PeerJS
        let conn;

        // 1. Gdy serwer przydzieli nam unikalne ID
        peer.on('open', (id) => {
            document.getElementById('my-id').innerText = id;
            document.getElementById('status').innerText = "Gotowy do połączenia";
        });

        // 2. Obsługa przychodzącego połączenia (jeśli ktoś łączy się z nami)
        peer.on('connection', (connection) => {
            conn = connection;
            setupConnection();
            document.getElementById('status').innerText = "Połączono (jako Host)!";
        });

        // 3. Funkcja łączenia się z innym graczem
        function connectToPeer() {
            const peerId = document.getElementById('peer-id-input').value;
            conn = peer.connect(peerId);
            setupConnection();
            document.getElementById('status').innerText = "Łączenie...";
        }

        // 4. Konfiguracja wymiany danych
        function setupConnection() {
            document.getElementById('game-area').style.display = 'block';

            conn.on('open', () => {
                document.getElementById('status').innerText = "Połączono!";
            });

            conn.on('data', (data) => {
                const msgBox = document.getElementById('messages');
                msgBox.innerHTML += `<p>Otrzymano: <b>${data}</b></p>`;
            });
        }

        // 5. Wysyłanie danych
        function sendData() {
            const val = document.getElementById('msg-input').value;
            if (conn && conn.open) {
                conn.send(val);
                document.getElementById('messages').innerHTML += `<p>Wysłano: ${val}</p>`;
            }
        }
    </script>
</body>
</html>