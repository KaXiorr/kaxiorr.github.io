<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spektrum - Gra Multiplayer</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #2c3e50; color: white; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #34495e; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        h1 { margin-top: 0; color: #f1c40f; letter-spacing: 2px; }
        h2 { border-bottom: 2px solid #7f8c8d; padding-bottom: 10px; }
        
        .screen { display: none; }
        .active { display: block; }
        
        input, select { padding: 12px; border-radius: 5px; border: none; width: 80%; margin: 10px 0; font-size: 16px; text-align: center;}
        button { padding: 12px 25px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: 0.2s; font-weight: bold; }
        
        .btn-primary { background: #27ae60; color: white; }
        .btn-primary:hover { background: #2ecc71; }
        .btn-secondary { background: #e67e22; color: white; }
        .btn-secondary:hover { background: #d35400; }
        .btn-disabled { background: #95a5a6; cursor: not-allowed; }
        .btn-action { background: #3498db; color: white; }

        .player-list { list-style: none; padding: 0; text-align: left; }
        .player-item { background: #ecf0f1; color: #2c3e50; margin: 5px 0; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .status-ready { color: #27ae60; font-weight: bold; }
        .status-wait { color: #e74c3c; font-weight: bold; }
        
        .room-code { font-size: 2em; letter-spacing: 5px; background: #2c3e50; padding: 10px; border: 2px dashed #f1c40f; display: inline-block; margin: 10px 0; color: #f1c40f; }
        #error-msg { color: #e74c3c; margin-top: 10px; min-height: 20px; }

        /* Style gry */
        .secret-number { font-size: 3em; color: #f1c40f; font-weight: bold; margin: 10px 0; }
        .category-box { background: #2c3e50; padding: 15px; margin: 15px 0; border-radius: 8px; border: 1px solid #7f8c8d; }
        .cat-left { color: #e74c3c; font-weight: bold; float: left; width: 45%; text-align: left;}
        .cat-right { color: #3498db; font-weight: bold; float: right; width: 45%; text-align: right;}
        .clearfix::after { content: ""; clear: both; display: table; }
        
        .hint-word { font-size: 1.5em; color: #f1c40f; margin: 20px 0; text-transform: uppercase; }
        .guess-btn { width: 40px; height: 40px; margin: 5px; cursor: pointer; background: #ecf0f1; border: none; font-weight: bold; color: #333; }
        .guess-btn:hover { background: #f1c40f; }
        .guess-btn.selected { background: #f1c40f; transform: scale(1.2); }
    </style>
</head>
<body>

<div class="container">
    <h1>SPEKTRUM</h1>
    <div id="error-msg"></div>

    <div id="screen-menu" class="screen active">
        <button class="btn-primary" onclick="showScreen('screen-host-setup')">StwÃ³rz GrÄ™</button>
        <button class="btn-secondary" onclick="showScreen('screen-join-setup')">DoÅ‚Ä…cz do Gry</button>
    </div>

    <div id="screen-host-setup" class="screen">
        <h2>Ustawienia Gry</h2>
        <input type="text" id="host-nick" placeholder="TwÃ³j Nick" maxlength="12">
        <br>
        <label>Liczba graczy (2-5):</label>
        <select id="max-players">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <br>
        <button class="btn-secondary" onclick="showScreen('screen-menu')">WrÃ³Ä‡</button>
        <button class="btn-primary" onclick="createGame()">UtwÃ³rz Lobby</button>
    </div>

    <div id="screen-join-setup" class="screen">
        <h2>DoÅ‚Ä…cz do Gry</h2>
        <input type="text" id="join-nick" placeholder="TwÃ³j Nick" maxlength="12">
        <input type="number" id="join-code" placeholder="4-cyfrowy kod" max="9999">
        <br>
        <button class="btn-secondary" onclick="showScreen('screen-menu')">WrÃ³Ä‡</button>
        <button class="btn-primary" onclick="joinGame()">DoÅ‚Ä…cz</button>
    </div>

    <div id="screen-lobby" class="screen">
        <h2>Lobby</h2>
        <p>Kod pokoju:</p>
        <div id="display-code" class="room-code">----</div>
        <p>Gracze: <span id="player-count">0/0</span></p>
        
        <ul id="players-list" class="player-list"></ul>

        <div id="controls-host" style="display:none;">
            <p style="font-size: 0.9em; color: #bdc3c7;">JesteÅ› Hostem. Czekaj na wszystkich.</p>
            <button id="btn-start" class="btn-disabled" onclick="startGame()" disabled>Rozpocznij GrÄ™</button>
        </div>

        <div id="controls-client" style="display:none;">
            <button id="btn-ready" class="btn-secondary" onclick="toggleReady()">Jestem Gotowy</button>
        </div>
    </div>

    <div id="screen-hinting" class="screen">
        <div id="view-guesser-wait" style="display:none;">
            <h2>JesteÅ› ZgadujÄ…cym!</h2>
            <p>Zrelaksuj siÄ™. Inni gracze wÅ‚aÅ›nie wymyÅ›lajÄ… podpowiedzi do tajnej liczby.</p>
            <div style="font-size: 3em;">ðŸ¤«</div>
        </div>

        <div id="view-hinter-active" style="display:none;">
            <h2>Twoje Zadanie</h2>
            <p>Tajna liczba to:</p>
            <div class="secret-number" id="secret-target">?</div>
            
            <p>Twoja kategoria:</p>
            <div class="category-box clearfix">
                <div class="cat-left" id="cat-left">...</div>
                <div class="cat-right" id="cat-right">...</div>
            </div>

            <input type="text" id="hint-input" placeholder="Wpisz jedno sÅ‚owo/skojarzenie...">
            <button class="btn-primary" onclick="submitHint()">ZatwierdÅº PodpowiedÅº</button>
            <p style="font-size: 0.8em; color:#bdc3c7;">Ocena 1 to lewa strona, 10 to prawa strona.</p>
        </div>
        
        <div id="view-hinter-done" style="display:none;">
            <h3>PodpowiedÅº wysÅ‚ana!</h3>
            <p>Czekamy na resztÄ™ podpowiadaczy...</p>
        </div>
    </div>

    <div id="screen-guessing" class="screen">
        <h2>Zgadywanie</h2>
        <p>ZgadujÄ…cy: <span id="current-guesser-name" style="color:#f1c40f; font-weight:bold;"></span></p>
        
        <div class="category-box clearfix">
            <div class="cat-left" id="guess-cat-left">Tanie</div>
            <div class="cat-right" id="guess-cat-right">Drogie</div>
        </div>

        <p>PodpowiedÅº gracza <span id="hinter-name">...</span>:</p>
        <div class="hint-word" id="current-hint-word">...</div>

        <div id="guesser-controls" style="display:none;">
            <button class="btn-action" id="btn-next-hint" onclick="nextHint()">NastÄ™pna podpowiedÅº âž¡</button>
            
            <div id="final-guess-area" style="display:none; margin-top: 20px; border-top: 1px solid #7f8c8d; padding-top: 10px;">
                <p>Wszystkie podpowiedzi odkryte. Jaka to liczba?</p>
                <div id="guess-buttons">
                    </div>
                <button class="btn-primary" onclick="confirmGuess()">ZGADUJÄ˜!</button>
            </div>
        </div>
        
        <p id="spectator-msg" style="display:none; color: #bdc3c7;">ZgadujÄ…cy analizuje podpowiedzi...</p>
    </div>

    <div id="screen-result" class="screen">
        <h2 id="result-title">KONIEC RUNDY</h2>
        
        <p>Szukana liczba: <span class="secret-number" id="result-target">5</span></p>
        <p>StrzaÅ‚ zgadujÄ…cego: <span class="secret-number" id="result-guess" style="color:white;">5</span></p>
        
        <div id="result-msg" style="font-size: 1.5em; margin: 20px; font-weight: bold;"></div>
        
        <div id="host-restart" style="display:none;">
            <button class="btn-primary" onclick="restartGame()">Zagraj Ponownie</button>
        </div>
        <p id="client-restart-msg" style="display:none;">Czekaj na Hosta...</p>
    </div>

</div>

<script>
    // --- BAZA KATEGORII ---
    const CATEGORIES = [
        ["Tanie", "Drogie"],
        ["Zdrowe jedzenie", "Niezdrowe jedzenie"],
        ["Najgorszy aktor", "Najlepszy aktor"],
        ["BezuÅ¼yteczne", "NiezbÄ™dne do Å¼ycia"],
        ["Ciche", "GÅ‚oÅ›ne"],
        ["Legalne", "Nielegalne"],
        ["Film dla dzieci", "Film dla dorosÅ‚ych"],
        ["Lekkie", "CiÄ™Å¼kie"],
        ["Nudne hobby", "EkscytujÄ…ce hobby"],
        ["Zimne", "GorÄ…ce"],
        ["Åagodne", "Pikantne"],
        ["SÅ‚abe zwierze", "Silne zwierze"],
        ["MiÄ™kkie", "Twarde"],
        ["Brzydkie", "PiÄ™kne"],
        ["Pachnie", "Åšmierdzi"],
        ["Bezpieczne", "Niebezpieczne"],
        ["MÄ…dre", "GÅ‚upie"],
        ["Staromodne", "Nowoczesne"]
    ];

    // --- ZMIENNE GLOBALNE ---
    const PREFIX = "spektrum-game-"; 
    let peer = null;
    let myConn = null; 
    let hostConns = []; 
    
    let isHost = false;
    let myNick = "";
    let roomCode = "";

    // GÅ‚Ã³wny stan gry
    let gameState = {
        maxPlayers: 0,
        players: [], // {peerId, nick, isReady, isHost, role ('GUESSER'|'HINTER'), hintData: {word, catLeft, catRight, submitted}}
        phase: 'LOBBY', // LOBBY, HINTING, GUESSING, RESULT
        targetNumber: 5,
        guesserId: null,
        currentHintIndex: 0, // KtÃ³rÄ… podpowiedÅº oglÄ…damy w fazie GUESSING
        finalGuess: null,
        winner: false
    };

    // --- NAWIGACJA ---
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('error-msg').innerText = "";
    }

    function showError(msg) {
        document.getElementById('error-msg').innerText = msg;
    }

    function createGame() {
    const nick = document.getElementById('host-nick').value.trim();
    const max = parseInt(document.getElementById('max-players').value);
    if (!nick) return showError("Podaj nick!");
    
    myNick = nick;
    isHost = true;
    gameState.maxPlayers = max;
    
    // SprÃ³bujmy wygenerowaÄ‡ kod i zainicjowaÄ‡ Peer
    roomCode = Math.floor(1000 + Math.random() * 9000).toString(); 
    
    // JeÅ›li Peer juÅ¼ istniaÅ‚ (np. po bÅ‚Ä™dzie), zniszcz go
    if (peer) peer.destroy();

    peer = new Peer(PREFIX + roomCode);

    // WyÅ›wietl status Å‚adowania
    document.getElementById('display-code').innerText = "Åadowanie...";

    peer.on('open', (id) => {
        console.log("PoÅ‚Ä…czono z serwerem PeerJS. ID pokoju: " + roomCode);
        gameState.players = [{
            peerId: id,
            nick: myNick,
            isReady: false,
            isHost: true,
            role: 'HINTER',
            hintData: null
        }];
        setupLobbyUI();
        showScreen('screen-lobby');
        document.getElementById('display-code').innerText = roomCode;
        
        peer.on('connection', (conn) => {
            handleIncomingConnection(conn);
        });
    });

    peer.on('error', (err) => {
        console.error("BÅ‚Ä…d PeerJS:", err.type);
        if(err.type === 'unavailable-id') {
            // JeÅ›li ID zajÄ™te, sprÃ³buj jeszcze raz automatycznie
            createGame(); 
        } else {
            showError("BÅ‚Ä…d poÅ‚Ä…czenia: " + err.type);
            document.getElementById('display-code').innerText = "BÅÄ„D";
        }
    });
}
    function handleIncomingConnection(conn) {
        if (gameState.players.length >= gameState.maxPlayers || gameState.phase !== 'LOBBY') {
            conn.on('open', () => {
                conn.send({type: 'ERROR', msg: 'PokÃ³j peÅ‚ny lub gra trwa'});
                setTimeout(() => conn.close(), 500);
            });
            return;
        }
        hostConns.push(conn);
        conn.on('data', (data) => handleDataPacket(data, conn.peer));
        conn.on('close', () => {
            gameState.players = gameState.players.filter(p => p.peerId !== conn.peer);
            broadcastState();
        });
    }

    // --- KLIENT LOGIKA ---
    function joinGame() {
        const nick = document.getElementById('join-nick').value.trim();
        const code = document.getElementById('join-code').value.trim();
        if (!nick || code.length !== 4) return showError("Podaj nick i poprawny kod!");

        myNick = nick;
        isHost = false;
        peer = new Peer();

        peer.on('open', () => {
            const hostId = PREFIX + code;
            myConn = peer.connect(hostId);

            myConn.on('open', () => {
                setupLobbyUI(); // KLUCZOWE - POKAZANIE UI
                showScreen('screen-lobby');
                document.getElementById('display-code').innerText = code;
                myConn.send({ type: 'JOIN', nick: myNick });
            });

            myConn.on('data', (data) => handleClientData(data));
            myConn.on('error', () => showError("BÅ‚Ä…d poÅ‚Ä…czenia."));
            setTimeout(() => { if(!myConn || !myConn.open) showError("Nie udaÅ‚o siÄ™ poÅ‚Ä…czyÄ‡."); }, 3000);
        });
    }

    // --- LOGIKA STANU (HOST) ---
    function handleDataPacket(data, senderPeerId) {
        if (data.type === 'JOIN') {
            gameState.players.push({ peerId: senderPeerId, nick: data.nick, isReady: false, isHost: false, role: 'HINTER', hintData: null });
            broadcastState();
        } 
        else if (data.type === 'READY_TOGGLE') {
            const player = gameState.players.find(p => p.peerId === senderPeerId);
            if (player) {
                player.isReady = data.state;
                broadcastState();
            }
        }
        else if (data.type === 'SUBMIT_HINT') {
            const player = gameState.players.find(p => p.peerId === senderPeerId);
            if (player && player.hintData) {
                player.hintData.word = data.word;
                player.hintData.submitted = true;
                checkAllHintsSubmitted();
                broadcastState();
            }
        }
        else if (data.type === 'NEXT_HINT') {
            // Tylko aktualny zgadujÄ…cy moÅ¼e to wysÅ‚aÄ‡
            if (senderPeerId === gameState.guesserId) {
                // Sprawdzamy czy sÄ… jeszcze podpowiedzi
                const hints = gameState.players.filter(p => p.role === 'HINTER' && p.hintData.submitted);
                if (gameState.currentHintIndex < hints.length - 1) {
                    gameState.currentHintIndex++;
                }
                broadcastState();
            }
        }
        else if (data.type === 'SUBMIT_GUESS') {
            if (senderPeerId === gameState.guesserId) {
                gameState.finalGuess = data.number;
                gameState.phase = 'RESULT';
                gameState.winner = (gameState.finalGuess === gameState.targetNumber);
                broadcastState();
            }
        }
    }

    function checkAllHintsSubmitted() {
        const hinters = gameState.players.filter(p => p.role === 'HINTER');
        const allDone = hinters.every(p => p.hintData && p.hintData.submitted);
        if (allDone && hinters.length > 0) {
            gameState.phase = 'GUESSING';
            gameState.currentHintIndex = 0;
        }
    }

    // --- START GRY I RESET (HOST) ---
    function startGame() {
        if (!isHost) return;
        
        // 1. Losuj liczbÄ™ 1-10
        gameState.targetNumber = Math.floor(Math.random() * 10) + 1;
        
        // 2. Losuj zgadujÄ…cego
        const playerIndices = gameState.players.map((_, i) => i);
        const guesserIndex = playerIndices[Math.floor(Math.random() * playerIndices.length)];
        
        gameState.players.forEach((p, index) => {
            if (index === guesserIndex) {
                p.role = 'GUESSER';
                p.hintData = null;
                gameState.guesserId = p.peerId;
            } else {
                p.role = 'HINTER';
                // 3. Przydziel kategorie
                const cat = CATEGORIES[Math.floor(Math.random() * CATEGORIES.length)];
                p.hintData = {
                    catLeft: cat[0],
                    catRight: cat[1],
                    word: "",
                    submitted: false
                };
            }
        });

        gameState.phase = 'HINTING';
        broadcastState();
    }

    function restartGame() {
        // Resetujemy stan, ale zostawiamy graczy
        gameState.phase = 'LOBBY';
        gameState.finalGuess = null;
        gameState.currentHintIndex = 0;
        gameState.players.forEach(p => {
            p.isReady = false; // MuszÄ… potwierdziÄ‡ gotowoÅ›Ä‡ ponownie
            p.hintData = null;
        });
        broadcastState();
    }

    // --- KLIENT ODBIERA DANE ---
    function handleClientData(data) {
        if (data.type === 'UPDATE_STATE') {
            gameState = data.state;
            renderCurrentScreen();
        } else if (data.type === 'ERROR') {
            showError(data.msg);
        }
    }

    function broadcastState() {
        renderCurrentScreen(); 
        hostConns.forEach(conn => {
            if(conn.open) conn.send({ type: 'UPDATE_STATE', state: gameState });
        });
    }

    // --- RENDEROWANIE EKRANÃ“W ---
    function renderCurrentScreen() {
        if (gameState.phase === 'LOBBY') {
            showScreen('screen-lobby');
            renderLobby();
        } 
        else if (gameState.phase === 'HINTING') {
            showScreen('screen-hinting');
            renderHinting();
        }
        else if (gameState.phase === 'GUESSING') {
            showScreen('screen-guessing');
            renderGuessing();
        }
        else if (gameState.phase === 'RESULT') {
            showScreen('screen-result');
            renderResult();
        }
    }

    function renderLobby() {
        const list = document.getElementById('players-list');
        list.innerHTML = "";
        let allReady = true;
        
        gameState.players.forEach(p => {
            const li = document.createElement('li');
            li.className = "player-item";
            let statusText = p.isHost ? "HOST" : (p.isReady ? "GOTOWY" : "CZEKA");
            li.innerHTML = `<span>${p.nick} ${p.peerId === peer.id ? '(Ty)' : ''}</span><span class="${p.isReady || p.isHost ? 'status-ready' : 'status-wait'}">${statusText}</span>`;
            list.appendChild(li);
            if (!p.isHost && !p.isReady) allReady = false;
        });

        document.getElementById('player-count').innerText = `${gameState.players.length}/${gameState.maxPlayers}`;

        if (isHost) {
            const btn = document.getElementById('btn-start');
            if (gameState.players.length >= 2 && allReady) {
                btn.disabled = false;
                btn.classList.remove('btn-disabled');
                btn.classList.add('btn-primary');
            } else {
                btn.disabled = true;
                btn.classList.add('btn-disabled');
                btn.classList.remove('btn-primary');
            }
        } else {
            // Reset button state logic for client
            const btn = document.getElementById('btn-ready');
            const myPlayer = gameState.players.find(p => p.peerId === peer.id);
            if (myPlayer && myPlayer.isReady) {
                btn.innerText = "Nie gotowy";
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-secondary');
            } else {
                btn.innerText = "Jestem Gotowy";
                btn.classList.add('btn-secondary');
                btn.classList.remove('btn-primary');
            }
        }
    }

    function renderHinting() {
        const me = gameState.players.find(p => p.peerId === peer.id);
        
        if (me.role === 'GUESSER') {
            document.getElementById('view-guesser-wait').style.display = 'block';
            document.getElementById('view-hinter-active').style.display = 'none';
            document.getElementById('view-hinter-done').style.display = 'none';
        } else {
            // Jestem HINTER
            document.getElementById('view-guesser-wait').style.display = 'none';
            
            if (me.hintData.submitted) {
                document.getElementById('view-hinter-active').style.display = 'none';
                document.getElementById('view-hinter-done').style.display = 'block';
            } else {
                document.getElementById('view-hinter-active').style.display = 'block';
                document.getElementById('view-hinter-done').style.display = 'none';
                
                document.getElementById('secret-target').innerText = gameState.targetNumber;
                document.getElementById('cat-left').innerText = me.hintData.catLeft;
                document.getElementById('cat-right').innerText = me.hintData.catRight;
            }
        }
    }

    let selectedGuess = null;

    function renderGuessing() {
        const hinters = gameState.players.filter(p => p.role === 'HINTER' && p.hintData.submitted);
        const currentHint = hinters[gameState.currentHintIndex];
        const me = gameState.players.find(p => p.peerId === peer.id);
        const guesser = gameState.players.find(p => p.role === 'GUESSER');

        document.getElementById('current-guesser-name').innerText = guesser.nick;
        
        // WyÅ›wietlanie aktualnej podpowiedzi
        document.getElementById('guess-cat-left').innerText = currentHint.hintData.catLeft;
        document.getElementById('guess-cat-right').innerText = currentHint.hintData.catRight;
        document.getElementById('hinter-name').innerText = currentHint.nick;
        document.getElementById('current-hint-word').innerText = currentHint.hintData.word;

        const isGuesser = (me.role === 'GUESSER');
        const isLastHint = (gameState.currentHintIndex === hinters.length - 1);

        if (isGuesser) {
            document.getElementById('guesser-controls').style.display = 'block';
            document.getElementById('spectator-msg').style.display = 'none';
            
            const btnNext = document.getElementById('btn-next-hint');
            const finalArea = document.getElementById('final-guess-area');
            
            if (isLastHint) {
                btnNext.style.display = 'none';
                finalArea.style.display = 'block';
                renderGuessButtons();
            } else {
                btnNext.style.display = 'inline-block';
                finalArea.style.display = 'none';
            }
        } else {
            document.getElementById('guesser-controls').style.display = 'none';
            document.getElementById('spectator-msg').style.display = 'block';
        }
    }

    function renderGuessButtons() {
        const container = document.getElementById('guess-buttons');
        if (container.innerHTML !== "") return; // Nie generuj ponownie jeÅ›li juÅ¼ sÄ…

        for(let i=1; i<=10; i++) {
            const b = document.createElement('button');
            b.innerText = i;
            b.className = 'guess-btn';
            b.onclick = () => {
                selectedGuess = i;
                document.querySelectorAll('.guess-btn').forEach(btn => btn.classList.remove('selected'));
                b.classList.add('selected');
            };
            container.appendChild(b);
        }
    }

    function renderResult() {
        const title = document.getElementById('result-title');
        const msg = document.getElementById('result-msg');
        
        document.getElementById('result-target').innerText = gameState.targetNumber;
        document.getElementById('result-guess').innerText = gameState.finalGuess;

        if (gameState.winner) {
            title.innerText = "ZWYCIÄ˜STWO!";
            title.style.color = "#27ae60";
            msg.innerText = "Gratulacje! ZgadliÅ›cie liczbÄ™!";
        } else {
            title.innerText = "PRZEGRANA";
            title.style.color = "#e74c3c";
            msg.innerText = `Niestety. Poprawna liczba to ${gameState.targetNumber}.`;
        }

        if (isHost) {
            document.getElementById('host-restart').style.display = 'block';
            document.getElementById('client-restart-msg').style.display = 'none';
        } else {
            document.getElementById('host-restart').style.display = 'none';
            document.getElementById('client-restart-msg').style.display = 'block';
        }
    }

    // --- AKCJE GRACZY ---

    function setupLobbyUI() {
        if (isHost) {
            document.getElementById('controls-host').style.display = 'block';
            document.getElementById('controls-client').style.display = 'none';
        } else {
            document.getElementById('controls-host').style.display = 'none';
            document.getElementById('controls-client').style.display = 'block';
        }
    }

    function toggleReady() {
        if (isHost) return;
        const myPlayer = gameState.players.find(p => p.peerId === peer.id);
        const newState = !myPlayer.isReady;
        myConn.send({ type: 'READY_TOGGLE', state: newState });
    }

    function submitHint() {
        const word = document.getElementById('hint-input').value.trim();
        if (!word) return alert("Wpisz sÅ‚owo!");
        
        // Host aktualizuje od razu, klient wysyÅ‚a
        if (isHost) {
            const me = gameState.players.find(p => p.peerId === peer.id);
            me.hintData.word = word;
            me.hintData.submitted = true;
            checkAllHintsSubmitted();
            broadcastState();
        } else {
            myConn.send({ type: 'SUBMIT_HINT', word: word });
            // Lokalne UI update, Å¼eby nie czekaÄ‡ na roundtrip
            document.getElementById('view-hinter-active').style.display = 'none';
            document.getElementById('view-hinter-done').style.display = 'block';
        }
    }

    function nextHint() {
        // Tylko dla hosta i klienta (jeÅ›li jest zgadujÄ…cym)
        if (isHost) {
            const hints = gameState.players.filter(p => p.role === 'HINTER' && p.hintData.submitted);
             if (gameState.currentHintIndex < hints.length - 1) {
                gameState.currentHintIndex++;
                broadcastState();
            }
        } else {
            myConn.send({ type: 'NEXT_HINT' });
        }
    }

    function confirmGuess() {
        if (!selectedGuess) return alert("Wybierz liczbÄ™!");
        if (isHost) {
            gameState.finalGuess = selectedGuess;
            gameState.phase = 'RESULT';
            gameState.winner = (gameState.finalGuess === gameState.targetNumber);
            broadcastState();
        } else {
            myConn.send({ type: 'SUBMIT_GUESS', number: selectedGuess });
        }
    }

</script>
</body>
</html>